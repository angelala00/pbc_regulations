# Agent Streaming Interaction Guide

## ğŸ’¡ æµå¼èŠ‚ç‚¹å±•ç¤ºï¼ˆè‰æ¡ˆï¼‰

> æœ¬èŠ‚ç”¨äºæ¢³ç†â€œæ€è€ƒè¿‡ç¨‹â€å¯è§†åŒ–çš„äº¤äº’ä¸èŠ‚ç‚¹åˆ†ç±»ï¼Œå¾…æ–¹æ¡ˆæˆç†Ÿåå†ä¸Šå‡ä¸ºæ­£å¼åè®®å­—æ®µã€‚

### èŠ‚ç‚¹ç±»å‹

- **æ€è€ƒèŠ‚ç‚¹**ï¼šå¯¹åº”æ¨¡å‹çº¯å†…éƒ¨æ¨ç†è¿‡ç¨‹ï¼ˆæ˜¯å¦è°ƒç”¨å·¥å…·ã€å¦‚ä½•è§£è¯»æ¡æ¬¾ç­‰ï¼‰ã€‚
  - è¿›è¡Œä¸­ï¼šé»˜è®¤å±•å¼€å¹¶æ»šåŠ¨å±•ç¤ºæœ€æ–°æ€è€ƒæ–‡æœ¬ï¼›æ ‡é¢˜å½¢å¦‚â€œæ­£åœ¨åˆ†ææ¡æ¬¾è§£è¯»â€ã€‚
  - å®Œæˆåï¼šè‡ªåŠ¨æ”¶èµ·ï¼Œæ ‡é¢˜åˆ‡æ¢ä¸ºâ€œæ¡æ¬¾è§£è¯»å·²å®Œæˆâ€ï¼Œç‚¹å‡»å¯å†æ¬¡å±•å¼€æŸ¥çœ‹å®Œæ•´å†…å®¹ã€‚
- **å·¥å…·èŠ‚ç‚¹**ï¼šè¡¨ç¤ºä¸€æ¬¡ç›´æ¥è§¦å‘çš„å·¥å…·è°ƒç”¨ï¼ˆä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“ã€è§¦å‘è¡¥å……æ£€ç´¢ç­‰çº¯å‡½æ•°å¼èƒ½åŠ›ï¼‰ã€‚
  - è¿›è¡Œä¸­ï¼šæ ‡é¢˜ç¤ºä¾‹â€œæ­£åœ¨è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢â€ï¼Œå±•å¼€åŒºåŸŸå†…å¯ä»¥æŒ‰å­æ­¥éª¤æ˜¾ç¤ºâ€œå‡†å¤‡å‚æ•°â€â€œç­‰å¾…å“åº”â€ç­‰å®æ—¶çŠ¶æ€ã€‚
  - å®Œæˆåï¼šæ ‡é¢˜åˆ‡æ¢ä¸ºâ€œæ•°æ®åº“æŸ¥è¯¢å®Œæˆâ€ï¼Œæ•´ä½“æ”¶èµ·ï¼Œç‚¹å‡»å¯å±•å¼€æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—æˆ–è¾“å‡ºç‰‡æ®µã€‚
- **å­ Agent èŠ‚ç‚¹**ï¼šè¡¨ç¤ºå§”æ´¾ç»™å¦ä¸€ä¸ª Agent çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚â€œæ³•è§„æ£€ç´¢â€åœ¨å½“å‰ä¸šåŠ¡ä¸­å³å±äºå­ Agentï¼‰ã€‚
  - è¿›è¡Œä¸­ï¼šæ ‡é¢˜å¯ä¸ºâ€œAgent[å›¾æ ‡] æ³•è§„æ£€ç´¢è¿›è¡Œä¸­â€ï¼Œå±•å¼€å†…å®¹ç”±å­ Agent è‡ªå·±çš„ `node_delta` ç»„æˆã€‚é€šå¸¸å­ Agent é‡Œä¼šåƒä¸»agentèŠ‚ç‚¹ä¸€æ ·ï¼Œé‡Œé¢ä¹Ÿæœ‰åŒæ ·çš„åµŒå¥—ç»“æ„ã€‚
  - å®Œæˆåï¼šæ ‡é¢˜åˆ‡æ¢æˆâ€œAgent[å›¾æ ‡] æ³•è§„æ£€ç´¢å·²å®Œæˆâ€ï¼Œé»˜è®¤æ”¶èµ·ï¼Œç”¨æˆ·å¯ç‚¹å¼€æŸ¥çœ‹è®°å½•ã€‚

ä»¥ä¸Šä¸‰ç±»èŠ‚ç‚¹å…±äº«ç»Ÿä¸€çš„äº‹ä»¶æ¨¡å‹ï¼š`node_start`ï¼ˆå»ºèŠ‚ç‚¹ï¼‰ã€`node_delta`ï¼ˆå†…å®¹å¢é‡ï¼‰ã€`node_end`ï¼ˆç»“æŸå¹¶æ ‡æ³¨çŠ¶æ€ï¼‰ã€‚è¿™æ ·å‰ç«¯å¯ä»¥ä»…ä¾èµ– node_* ä¸‰ç±»äº‹ä»¶å®Œæˆå±•å¼€/æ”¶èµ·ã€è¿›åº¦å±•ç¤ºä¸åµŒå¥—æ¸²æŸ“ã€‚

### å®Œæ•´ç¤ºä¾‹ï¼š

ä¸‹é¢ç¤ºä¾‹èšç„¦â€œä¸» Agent â†’ å­ Agent â†’ ä¸»å†…å®¹è¾“å‡ºâ€çš„å…¸å‹æµã€‚ä¸ºä¾¿äºé˜…è¯»ï¼Œç»Ÿä¸€ç”¨ SSE è¡Œçš„ `data:` å½¢å¼ï¼Œå¹¶åœ¨ `node_delta` ä¸­å±•ç¤ºåµŒå¥—äº‹ä»¶ã€‚

```
data: {"event":"message_start","response_id":"r1","message_id":"m1","created":1}

data: {"event":"node_start","response_id":"r1","message_id":"m1","node_id":"n1","type":"thinking","title":"æ€è€ƒ","created":2}
data: {"event":"node_delta","response_id":"r1","message_id":"m1","node_id":"n1","delta":"æˆ‘éœ€è¦æ£€ç´¢'è¿è§„å‘è¡Œé¢„ä»˜å¡'ç›¸å…³çš„æ³•å¾‹","created":3}
data: {"event":"node_end","response_id":"r1","message_id":"m1","node_id":"n1","status":"completed","title":"æ€è€ƒ","created":4}

data: {"event":"node_start","response_id":"r1","message_id":"m1","node_id":"n1","type":"tool","title":"é˜…è¯»æ³•å¾‹ç›®å½•","created":2}
data: {"event":"node_delta","response_id":"r1","message_id":"m1","node_id":"n1","delta":"è°ƒç”¨æ³•å¾‹ç›®å½•ï¼Œå¹¶æ‰¹é‡åˆ†æä»¥æŸ¥æ‰¾ä¸é—®é¢˜ç›¸å…³çš„æ³•å¾‹","created":3}
data: {"event":"node_end","response_id":"r1","message_id":"m1","node_id":"n1","status":"completed","title":"åˆ†ææ³•å¾‹ç›®å½•","created":4}

data: {"event":"node_start","response_id":"r1","message_id":"m1","node_id":"n1","type":"tool","title":"é˜…è¯»æ³•å¾‹åŸæ–‡","created":2}
data: {"event":"node_delta","response_id":"r1","message_id":"m1","node_id":"n1","delta":"æ ¹æ®ç›¸å…³æ³•å¾‹ï¼Œæ‰¹é‡é˜…è¯»åŸæ–‡ï¼Œæå–ç›¸å…³æ¡æ¬¾","created":3}
data: {"event":"node_end","response_id":"r1","message_id":"m1","node_id":"n1","status":"completed","title":"é˜…è¯»æ³•å¾‹åŸæ–‡","created":4}

data: {"event":"node_start","response_id":"r1","message_id":"m1","node_id":"n3","type":"thinking","title":"æ­£åœ¨ç»¼åˆåˆ†æ","created":23}
data: {"event":"node_delta","response_id":"r1","message_id":"m1","node_id":"n3","delta":"æ•´ç†æ£€ç´¢åˆ°çš„æ³•å¾‹æ¡æ¬¾ï¼Œæ•´ç†è¾“å‡º...","created":24}
data: {"event":"node_end","response_id":"r1","message_id":"m1","node_id":"n3","status":"completed","title":"åˆ†ææ•´ç†","created":25}

data: {"event":"content_delta","response_id":"r1","message_id":"m1","node_id":null,"index":0,"delta":"ç»“æ„åŒ–è¾“å‡ºå†…å®¹...","role":"assistant","created":26,"metadata":{"channel":"final"}}
data: {"event":"message_end","response_id":"r1","message_id":"m1","created":27}
data: {"event":"done","response_id":"r1","message_id":"m1","created":28}
```

è¦ç‚¹ï¼š
- æ‰€æœ‰èŠ‚ç‚¹ä»éµå¾ª `node_start â†’ node_delta* â†’ node_end` çš„ç”Ÿå‘½å‘¨æœŸã€‚
- `node_delta` å¯æºå¸¦çº¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥åƒç¤ºä¾‹ä¸­é‚£æ ·æ‰¿è½½ç»“æ„åŒ–äº‹ä»¶ï¼Œæ–¹ä¾¿å°†å½“å‰ Agent è§†ä½œçˆ¶èŠ‚ç‚¹ï¼Œè€ŒæŠŠå­ Agent çš„æ‰€æœ‰äº‹ä»¶åŸæ ·åµŒå…¥ã€‚
- é¡¶å±‚ `content_delta`ã€`message_end`ã€`done` ä¿æŒåœ¨èŠ‚ç‚¹æ ‘ä¹‹å¤–ï¼Œé€šè¿‡ `node_id:null` ç­‰å­—æ®µæ˜ç¡®å½’å±ï¼Œä¾¿äºå‰ç«¯åŒºåˆ†â€œä¸»å›å¤â€ä¸â€œèŠ‚ç‚¹å†…è¾“å‡ºâ€ã€‚

### å­ Agent è¾“å‡ºçš„å°è£…æŒ‡å—

ä¸» Agent å¹¶ä¸éœ€è¦å°†å­ Agent çš„åŸå§‹ `content_delta`/`node_delta` ä¸€è‚¡è„‘è½¬å‘ç»™å‰ç«¯ï¼Œå¯ä»¥æŒ‰éœ€å°è£…ä¸ºæ›´å‹å¥½çš„èŠ‚ç‚¹ç»“æ„ã€‚æ¨èåšæ³•ï¼š

- **è½¬è¯‘ä¸ºå†…å®¹èŠ‚ç‚¹**ï¼šå½“å­ Agent äº§ç”Ÿé˜¶æ®µæ€§ `content_delta` æ—¶ï¼Œçˆ¶èŠ‚ç‚¹å¯æ–°å»º `type:"content"` çš„å­èŠ‚ç‚¹ï¼Œç„¶åå°†é˜¶æ®µæ€§è¿›å±•å†™å…¥ `node_delta`ï¼Œç¤ºä¾‹ï¼š
  - `node_start(node_id:"s_content", type:"content", title:"æ³•è§„æ£€ç´¢è¿›å±•")`
  - `node_delta(node_id:"s_content", delta:"å·²å®Œæˆç›®å½•æ£€ç´¢ï¼Œå‡†å¤‡é˜…è¯»åŸæ–‡...")`
  - `node_end(node_id:"s_content", status:"completed")`
- **ç»“æœæè¿°èŠ‚ç‚¹**ï¼šå½“å­ Agent å¾—åˆ°æœ€ç»ˆè¾“å‡ºï¼Œå¯å†åˆ›å»º `type:"result"`ï¼ˆæˆ–å…¶ä»–è‡ªå®šä¹‰ç±»å‹ï¼‰çš„èŠ‚ç‚¹ï¼Œä»…ä¿ç•™é¢å‘ç”¨æˆ·çš„ç»“è®ºï¼Œå±è”½å†…éƒ¨æ—¥å¿—ã€‚
- **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**ï¼šå­ Agent çš„ä»»ä½• `node_delta`/`content_delta` éƒ½å¯ä»¥å…ˆç»è¿‡ä¸» Agent åˆ¤æ–­ï¼Œåªæœ‰éœ€è¦è®©å‰ç«¯çœ‹åˆ°çš„æ‰å°è£…è¿›æ–°çš„èŠ‚ç‚¹ï¼›æ— è®ºæ˜¯å®æ—¶è¿›åº¦è¿˜æ˜¯æœ€ç»ˆç»“æœï¼Œéƒ½ç”±ä¸» Agent å†³å®šæ˜¯å¦ `yield`ã€‚

é€šè¿‡è¿™å±‚å°è£…ï¼Œå‰ç«¯åè®®ä¿æŒç®€æ´ä¸€è‡´ï¼ŒåŒæ—¶ä¸» Agent ä¹Ÿèƒ½çµæ´»æ§åˆ¶ä¸åŒå­ Agent çš„å±•ç¤ºç²’åº¦ã€‚
